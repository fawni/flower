---
import TrackCard from "@components/TrackCard.astro";

const username = "aokiare";
const api_key = import.meta.env.LASTFM_API_KEY;

const tracks = await fetch(
  `http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${username}&api_key=${api_key}&format=json`,
)
  .then(response => response.json())
  .then(data => {
    return data.recenttracks.track.slice(0, 5);
  })
  .catch(error => {
    console.error("Error fetching data:", error);
  });

const tracksData = tracks.map((track) => {
  return {
    name: track.name,
    artist: track.artist["#text"],
    url: track.url,
    cover_url: track.image[3]["#text"],
  };
});
---

<div class="tracks">
  {
    tracksData.map(
      (data) => (data ? <TrackCard {...data} /> : null),
    )
  }
</div>

<style>
.tracks {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  padding-bottom: 1.125rem;
}
</style>
